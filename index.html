<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meenit's Playzone</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: white; text-align: center; margin: 0; }
        .container { padding: 20px; }
        .card { background: #1e1e1e; border-radius: 15px; padding: 15px; margin: 10px auto; max-width: 400px; border: 1px solid #333; }
        .out { border-left: 5px solid #ff4d4d; opacity: 0.6; background: #2a1010; }
        .alive { border-left: 5px solid #4dff88; }
        .match-warn { color: #ffcc00; font-weight: bold; font-size: 12px; }
        button { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin: 5px; }
        .btn-host { background: #ff9f43; color: black; }
        .btn-play { background: #00d2d3; color: white; }
        #timer { font-size: 50px; font-weight: bold; color: #feca57; }
        input { padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: white; width: 70%; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Meenit’s Playzone</h1>
        <h3 id="game-title">Odd One In</h3>

        <div id="setup">
            <input id="nameInput" placeholder="Enter Your Name">
            <button class="btn-play" onclick="join()">Enter Lobby</button>
        </div>

        <div id="game" style="display:none;">
            <div id="host-panel" style="display:none;">
                <button class="btn-host" onclick="socket.emit('startTimer')">Start Round (10s)</button>
                <button class="btn-host" style="background:#54a0ff" onclick="socket.emit('resetGame')">Reset All</button>
            </div>
            
            <div id="timer">10</div>
            
            <div id="input-zone">
                <input id="ansInput" placeholder="Your Answer...">
                <button class="btn-play" onclick="sendAns()">Submit</button>
            </div>

            <div id="playerList" style="margin-top:20px;"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let myId = null;
        let isHost = false;

        socket.on("isHost", (val) => {
            isHost = val;
            if(isHost) document.getElementById("host-panel").style.display = "block";
        });

        function join() {
            const name = document.getElementById("nameInput").value;
            if(name) {
                socket.emit("joinGame", name);
                document.getElementById("setup").style.display = "none";
                document.getElementById("game").style.display = "block";
            }
        }

        function sendAns() {
            const val = document.getElementById("ansInput").value;
            socket.emit("submitAnswer", val);
            document.getElementById("ansInput").value = "";
        }

        socket.on("timerUpdate", (t) => { document.getElementById("timer").innerText = t; });

        socket.on("updatePlayers", (players) => {
            const listDiv = document.getElementById("playerList");
            listDiv.innerHTML = "";

            // Find duplicate answers
            const counts = {};
            players.forEach(p => {
                if(p.answer) counts[p.answer.toLowerCase()] = (counts[p.answer.toLowerCase()] || 0) + 1;
            });

            players.forEach(p => {
                const isMatch = p.answer && counts[p.answer.toLowerCase()] > 1;
                const div = document.createElement("div");
                div.className = `card ${p.status}`;
                div.innerHTML = `
                    <div>
                        <strong>${p.name}</strong><br>
                        <span>${p.answer || 'Waiting...'}</span>
                        ${isMatch ? '<div class="match-warn">⚠️ MATCHED!</div>' : ''}
                    </div>
                `;
                
                if(isHost) {
                    const btn = document.createElement("button");
                    btn.innerText = p.status === "alive" ? "Eliminate" : "Revive";
                    btn.onclick = () => socket.emit("toggleStatus", p.id);
                    div.appendChild(btn);
                }
                listDiv.appendChild(div);
            });
        });
    </script>
</body>
</html>
